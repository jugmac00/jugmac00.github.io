<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>getattr() Considered Harmful | Jürgen Gmach</title><meta name=keywords content="python,coverage"><meta name=description content="While Hynek already considered &ldquo;Considered Harmful&rdquo; was getting old in 2016, and so he named this blog post hasattr() – A Dangerous Misnomer, instead of hasattr() considered harmful, meanwhile it is 2022 and I still like that phrase.
So here we go&mldr;
getattr() considered harmful The setting is a CLI application with 100% test coverage, and even branch coverage is activated.
coverage 101 I assume you know what coverage is. 100% test coverage means that the test suite covers all lines of code of your library or application."><meta name=author content><link rel=canonical href=https://jugmac00.github.io/blog/getattr-considered-harmful/><link crossorigin=anonymous href=/assets/css/stylesheet.min.309a3942f890eb0930959205be1f692b2f0e85115a8b0190361a25a37e54fffa.css integrity="sha256-MJo5QviQ6wkwlZIFvh9pKy8OhRFaiwGQNholo35U//o=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://jugmac00.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://jugmac00.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://jugmac00.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://jugmac00.github.io/apple-touch-icon.png><link rel=mask-icon href=https://jugmac00.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.82.0"><meta property="og:title" content="getattr() Considered Harmful"><meta property="og:description" content="While Hynek already considered &ldquo;Considered Harmful&rdquo; was getting old in 2016, and so he named this blog post hasattr() – A Dangerous Misnomer, instead of hasattr() considered harmful, meanwhile it is 2022 and I still like that phrase.
So here we go&mldr;
getattr() considered harmful The setting is a CLI application with 100% test coverage, and even branch coverage is activated.
coverage 101 I assume you know what coverage is. 100% test coverage means that the test suite covers all lines of code of your library or application."><meta property="og:type" content="article"><meta property="og:url" content="https://jugmac00.github.io/blog/getattr-considered-harmful/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2022-04-16T15:40:58+02:00"><meta property="article:modified_time" content="2022-04-16T15:40:58+02:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="getattr() Considered Harmful"><meta name=twitter:description content="While Hynek already considered &ldquo;Considered Harmful&rdquo; was getting old in 2016, and so he named this blog post hasattr() – A Dangerous Misnomer, instead of hasattr() considered harmful, meanwhile it is 2022 and I still like that phrase.
So here we go&mldr;
getattr() considered harmful The setting is a CLI application with 100% test coverage, and even branch coverage is activated.
coverage 101 I assume you know what coverage is. 100% test coverage means that the test suite covers all lines of code of your library or application."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Blogs","item":"https://jugmac00.github.io/blog/"},{"@type":"ListItem","position":3,"name":"getattr() Considered Harmful","item":"https://jugmac00.github.io/blog/getattr-considered-harmful/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"getattr() Considered Harmful","name":"getattr() Considered Harmful","description":"While Hynek already considered \u0026ldquo;Considered Harmful\u0026rdquo; was getting old in 2016, and so he named this blog post hasattr() – A Dangerous Misnomer, instead of hasattr() considered harmful, meanwhile it is 2022 and I still like that phrase.\nSo here we go\u0026hellip;\ngetattr() considered harmful The setting is a CLI application with 100% test coverage, and even branch coverage is activated.\ncoverage 101 I assume you know what coverage is. 100% test coverage means that the test suite covers all lines of code of your library or application.","keywords":["python","coverage"],"articleBody":"While Hynek already considered “Considered Harmful” was getting old in 2016, and so he named this blog post hasattr() – A Dangerous Misnomer, instead of hasattr() considered harmful, meanwhile it is 2022 and I still like that phrase.\nSo here we go…\ngetattr() considered harmful The setting is a CLI application with 100% test coverage, and even branch coverage is activated.\ncoverage 101 I assume you know what coverage is. 100% test coverage means that the test suite covers all lines of code of your library or application. That does not mean they are functionally correct, but this means they are all run. This eliminates a couple of error classes, e.g. syntax errors.\nBut we still have a problem with e.g. the following code:\nif function_call(): do_something() When in our test suite function_call is true, both lines will be executed and a code coverage of 100% is shown.\nBut we may have never tested the case when function_call is false.\nhello branch coverage When you activate branch coverage, coverage.py will show an error for above code example:\n line x didn’t jump to line y, because the condition on line x was never false\n Excellent! We are safe… right?\nhello getattr() Back to our CLI application.\nA couple of weeks ago I renamed a flag for the application’s run command from --output to --output-directory.\nEasy change, clear improvement, no fear as we have 100% test coverage.\nhello regression Fast forward a couple of weeks.\nMy colleague created another merge proposal to fix a regression I introduced with the above renaming.\nI forgot to also update the flag for the run_one command.\nHow was this possible when we have 100% test coverage?\nLet’s have a look at the following code…\n_run_job(args.job, job, provider, getattr(args, \"output\", None)) If you have a close look at above line, you’ll notice that there is a hidden branch, ie the getattr covers two different outcomes:\n args has an attribute output args has no attribute output  This could have been written as:\nif hasattr(args, \"output\"): _run_job(args.job, job, provider, args.output) else: _run_job(args.job, job, provider, None) Certainly, then coverage, at least with activated branch coverage, would have raised the alarm!\nmore gotchas Please note that there are more idioms in Python which impede coverage from being reliable:\nx = {\"a\": 1, \"b\": 2}.get(\"z\", 99) x = condition and 0 or 1 x = 0 if condition else 1 I won’t list multiple statements on one line, combined with a semicolon, as flake8, which you hopefully use, will prevent this.\nAnd there might be more.\nDo you know more examples? Please contact me https://jugmac00.github.io/\nwhat to do Well, you could avoid using the above mentioned idioms. :-/\nYou could use mutation testing, which mutates the code and raises alarm if this does not cause a test failure. But that would be another topic.\nAt very least - be aware of these “invisible” test or coverage gaps!\n","wordCount":"485","inLanguage":"en","datePublished":"2022-04-16T15:40:58+02:00","dateModified":"2022-04-16T15:40:58+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://jugmac00.github.io/blog/getattr-considered-harmful/"},"publisher":{"@type":"Organization","name":"Jürgen Gmach","logo":{"@type":"ImageObject","url":"https://jugmac00.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://jugmac00.github.io accesskey=h title="Jürgen Gmach (Alt + H)">Jürgen Gmach</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://jugmac00.github.io/about/ title=about><span>about</span></a></li><li><a href=https://jugmac00.github.io/blog/ title=blog><span>blog</span></a></li><li><a href=https://jugmac00.github.io/til/ title=til><span>today-i-learned</span></a></li><li><a href=https://jugmac00.github.io/talks/ title=talks><span>talks</span></a></li><li><a href=https://jugmac00.github.io/hiring/ title=hiring><span>hiring</span></a></li><li><a href=https://jugmac00.github.io/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>getattr() Considered Harmful</h1><div class=post-meta>April 16, 2022</div></header><div class=post-content><p>While Hynek already considered &ldquo;Considered Harmful&rdquo; was getting old in 2016,
and so he named this blog post <a href=https://hynek.me/articles/hasattr/>hasattr() – A Dangerous Misnomer</a>,
instead of <em>hasattr() considered harmful</em>,
meanwhile it is 2022 and I still like that phrase.</p><p>So here we go&mldr;</p><h2 id=getattr-considered-harmful><code>getattr()</code> considered harmful<a hidden class=anchor aria-hidden=true href=#getattr-considered-harmful>#</a></h2><p>The setting is a CLI application with 100% test coverage,
and even <a href=https://coverage.readthedocs.io/en/6.3.2/branch.html>branch coverage</a> is activated.</p><h2 id=coverage-101>coverage 101<a hidden class=anchor aria-hidden=true href=#coverage-101>#</a></h2><p>I assume you know what coverage is.
100% test coverage means that the test suite covers all lines of code of your
library or application.
That does not mean they are functionally correct,
but this means they are all run.
This eliminates a couple of error classes, e.g. syntax errors.</p><p>But we still have a problem with e.g. the following code:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#66d9ef>if</span> function_call():
    do_something()
</code></pre></div><p>When in our test suite <code>function_call</code> is true,
both lines will be executed and a code coverage of 100% is shown.</p><p>But we may have never tested the case when <code>function_call</code> is false.</p><h2 id=hello-branch-coverage>hello branch coverage<a hidden class=anchor aria-hidden=true href=#hello-branch-coverage>#</a></h2><p>When you activate <a href=https://coverage.readthedocs.io/en/6.3.2/branch.html>branch coverage</a>,
<a href=https://coverage.readthedocs.io/>coverage.py</a> will show an error for above
code example:</p><blockquote><p>line x didn&rsquo;t jump to line y, because the condition on line x was never false</p></blockquote><p>Excellent! We are safe&mldr; right?</p><h2 id=hello-getattr>hello <code>getattr()</code><a hidden class=anchor aria-hidden=true href=#hello-getattr>#</a></h2><p>Back to our CLI application.</p><p>A couple of weeks ago I renamed a flag for the application&rsquo;s <code>run</code> command from
<code>--output</code> to <code>--output-directory</code>.</p><p>Easy change, clear improvement, no fear as we have 100% test coverage.</p><h2 id=hello-regression>hello regression<a hidden class=anchor aria-hidden=true href=#hello-regression>#</a></h2><p>Fast forward a couple of weeks.</p><p>My colleague created another merge proposal to fix a regression
I introduced with the above renaming.</p><p>I forgot to also update the flag for the <code>run_one</code> command.</p><p>How was this possible when we have 100% test coverage?</p><p>Let&rsquo;s have a look at the following code&mldr;</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>_run_job(args<span style=color:#f92672>.</span>job, job, provider, getattr(args, <span style=color:#e6db74>&#34;output&#34;</span>, None))
</code></pre></div><p>If you have a close look at above line,
you&rsquo;ll notice that there is a hidden branch,
ie the <code>getattr</code> covers two different outcomes:</p><ul><li><code>args</code> has an attribute <code>output</code></li><li><code>args</code> has no attribute <code>output</code></li></ul><p>This could have been written as:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#66d9ef>if</span> hasattr(args, <span style=color:#e6db74>&#34;output&#34;</span>):
    _run_job(args<span style=color:#f92672>.</span>job, job, provider, args<span style=color:#f92672>.</span>output)
<span style=color:#66d9ef>else</span>:
    _run_job(args<span style=color:#f92672>.</span>job, job, provider, None)
</code></pre></div><p>Certainly, then coverage, at least with activated branch coverage,
would have raised the alarm!</p><h2 id=more-gotchas>more gotchas<a hidden class=anchor aria-hidden=true href=#more-gotchas>#</a></h2><p>Please note that there are more idioms in Python which impede coverage from being reliable:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>x <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#34;a&#34;</span>: <span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#34;b&#34;</span>: <span style=color:#ae81ff>2</span>}<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;z&#34;</span>, <span style=color:#ae81ff>99</span>)
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>x <span style=color:#f92672>=</span> condition <span style=color:#f92672>and</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>or</span> <span style=color:#ae81ff>1</span>
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>x <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>if</span> condition <span style=color:#66d9ef>else</span> <span style=color:#ae81ff>1</span>
</code></pre></div><p>I won&rsquo;t list multiple statements on one line, combined with a semicolon,
as <a href=https://flake8.pycqa.org/en/latest/>flake8</a>,
which you hopefully use,
will prevent this.</p><p>And there might be more.</p><p>Do you know more examples? Please contact me <a href=https://jugmac00.github.io/>https://jugmac00.github.io/</a></p><h2 id=what-to-do>what to do<a hidden class=anchor aria-hidden=true href=#what-to-do>#</a></h2><p>Well, you could avoid using the above mentioned idioms. :-/</p><p>You could use <a href=https://en.wikipedia.org/wiki/Mutation_testing>mutation testing</a>,
which mutates the code and raises alarm if this does not cause a test failure.
But that would be another topic.</p><p>At very least - be aware of these &ldquo;invisible&rdquo; test or coverage gaps!</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://jugmac00.github.io/tags/python/>python</a></li><li><a href=https://jugmac00.github.io/tags/coverage/>coverage</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://jugmac00.github.io>Jürgen Gmach</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script></body></html>