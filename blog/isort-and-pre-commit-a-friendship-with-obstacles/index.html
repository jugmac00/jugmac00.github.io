<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>isort and pre-commit - a friendship with obstacles | Jürgen Gmach</title><meta name=keywords content><meta name=description content="Note This post is not intended to be an exhaustive introduction to pre-commit and its hooks. Please visit pre-commit.com for a complete documentation.
In a nutshell&mldr;
pre-commit From its website:
 A framework for managing and maintaining multi-language pre-commit hooks.
 Very simplified this means, whenever you try to commit changes in your project (e.g. entering git commit), pre-commit runs all configured tools (e.g. linter, formatter, &mldr;), and only if they run successfully, your commit will be executed - otherwise your commit will fail."><meta name=author content><link rel=canonical href=https://jugmac00.github.io/blog/isort-and-pre-commit-a-friendship-with-obstacles/><link crossorigin=anonymous href=/assets/css/stylesheet.min.309a3942f890eb0930959205be1f692b2f0e85115a8b0190361a25a37e54fffa.css integrity="sha256-MJo5QviQ6wkwlZIFvh9pKy8OhRFaiwGQNholo35U//o=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://jugmac00.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://jugmac00.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://jugmac00.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://jugmac00.github.io/apple-touch-icon.png><link rel=mask-icon href=https://jugmac00.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.82.0"><meta property="og:title" content="isort and pre-commit - a friendship with obstacles"><meta property="og:description" content="Note This post is not intended to be an exhaustive introduction to pre-commit and its hooks. Please visit pre-commit.com for a complete documentation.
In a nutshell&mldr;
pre-commit From its website:
 A framework for managing and maintaining multi-language pre-commit hooks.
 Very simplified this means, whenever you try to commit changes in your project (e.g. entering git commit), pre-commit runs all configured tools (e.g. linter, formatter, &mldr;), and only if they run successfully, your commit will be executed - otherwise your commit will fail."><meta property="og:type" content="article"><meta property="og:url" content="https://jugmac00.github.io/blog/isort-and-pre-commit-a-friendship-with-obstacles/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2020-02-23T14:06:45+02:00"><meta property="article:modified_time" content="2020-02-23T14:06:45+02:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="isort and pre-commit - a friendship with obstacles"><meta name=twitter:description content="Note This post is not intended to be an exhaustive introduction to pre-commit and its hooks. Please visit pre-commit.com for a complete documentation.
In a nutshell&mldr;
pre-commit From its website:
 A framework for managing and maintaining multi-language pre-commit hooks.
 Very simplified this means, whenever you try to commit changes in your project (e.g. entering git commit), pre-commit runs all configured tools (e.g. linter, formatter, &mldr;), and only if they run successfully, your commit will be executed - otherwise your commit will fail."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Blogs","item":"https://jugmac00.github.io/blog/"},{"@type":"ListItem","position":3,"name":"isort and pre-commit - a friendship with obstacles","item":"https://jugmac00.github.io/blog/isort-and-pre-commit-a-friendship-with-obstacles/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"isort and pre-commit - a friendship with obstacles","name":"isort and pre-commit - a friendship with obstacles","description":"Note This post is not intended to be an exhaustive introduction to pre-commit and its hooks. Please visit pre-commit.com for a complete documentation.\nIn a nutshell\u0026hellip;\npre-commit From its website:\n A framework for managing and maintaining multi-language pre-commit hooks.\n Very simplified this means, whenever you try to commit changes in your project (e.g. entering git commit), pre-commit runs all configured tools (e.g. linter, formatter, \u0026hellip;), and only if they run successfully, your commit will be executed - otherwise your commit will fail.","keywords":[],"articleBody":"Note This post is not intended to be an exhaustive introduction to pre-commit and its hooks. Please visit pre-commit.com for a complete documentation.\nIn a nutshell…\npre-commit From its website:\n A framework for managing and maintaining multi-language pre-commit hooks.\n Very simplified this means, whenever you try to commit changes in your project (e.g. entering git commit), pre-commit runs all configured tools (e.g. linter, formatter, …), and only if they run successfully, your commit will be executed - otherwise your commit will fail.\nThis is really great, as you will never ever forget to run your linter or other tools.\nisort One of those tools, which pre-commit can execute for you, is isort - short for “sort imports”.\nAs the name suggests, this little helper sorts your import statements, both alphabetical and also PEP 8 compliant, means e.g. standard library imports are separated from the ones of third party tools. And I like this a lot!\nA sample configuration for pre-commit to use isort could look like this - by the way, this is YAML:\n- repo: https://github.com/timothycrosley/isort rev: 4.3.21 hooks: - id: isort Also, you can customize isort to our liking, ie. put every import on one line. This is just one of many configuration options.\nAnd with the configuration options there comes the first problem.\ndon’t touch my migrations Whenever you run an application with a relational database, you probably also need to keep track of migrations, which usually consists of files with the diffs between two database schemes.\nFor my Flask app, those are stored in a subfolder called migrations.\nNo problem at all! Let’s use isort's skip / skip-glob option (see isort's wiki).\nLooks easy enough.\nAfter some googling, my first try would be something like this:\n[isort] skip = migrations This does not work. Hm, maybe I need to use globbing (wildcards)?\nNote I put isort’s configuration into my tox.ini file. You can certainly also use a dedicated .isort.cfg file. You’d have to replace the section isort with settings then.\nAfter some more googling I came up with this:\n[isort] skip_glob = */migrations/*.py Guess what? This also does not work. All my migration files still get sorted by isort.\nAfter some more investigation, I found https://github.com/timothycrosley/isort/issues/885 (as of 2021, this link no more works, as the repository was moved to another GitHub organization):\nThere is a new “never skip when passed a filename” behavior - which is… new. So, even if you put a file or a pattern into a skip option, it does not get skipped when passed to isort directly. And this is what I assume pre-commit is doing.\nOk, in the same issue a workaround was mentioned: Use --filter-files on the command line, which by the way, I do not use, as I use pre-commit, but fortunately you can add it to your pre-commit hook configuration:\n- repo: https://github.com/timothycrosley/isort rev: 4.3.21 hooks: - id: isort args: [--filter-files] It works!\nNote As an alternative, you could also add an exclude: migrations/ statement in your pre-commit-config.yaml.\nLet me rather say… it worked, until I updated from 4.3.21 to 4.3.21-2 - there are no changelog entries available for this update, but there were tons of changes, including different behavior which files should be scanned.\nWith this update, all files gets processed by isort, including .po, .rst, .json and many more.\nOk, what can we do about it?\nFirst, file an issue (https://github.com/timothycrosley/isort/issues/1154).\nReading the excellent pre-commit documentation, it seems there are several options, but filter by files looks very promising.\nThe files statement supports regular expressions, so the new hook looks like this:\n- repo: https://github.com/timothycrosley/isort rev: 4.3.21-2 hooks: - id: isort args: [--filter-files] files: \\.py$ And here we go… it finally works as intended.\nUpdate I could track down the faulty behavior (isort also touches files which are not Python files) to a regression/packaging bug - .pre-commit-hook.yaml is broken for 4.3.21-2 - see the issue at isort’s bug tracker.\nI removed the section about seed-isort-config, using this package is no longer necessary with the latest isort versions.\n","wordCount":"672","inLanguage":"en","datePublished":"2020-02-23T14:06:45+02:00","dateModified":"2020-02-23T14:06:45+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://jugmac00.github.io/blog/isort-and-pre-commit-a-friendship-with-obstacles/"},"publisher":{"@type":"Organization","name":"Jürgen Gmach","logo":{"@type":"ImageObject","url":"https://jugmac00.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://jugmac00.github.io accesskey=h title="Jürgen Gmach (Alt + H)">Jürgen Gmach</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://jugmac00.github.io/about/ title=about><span>about</span></a></li><li><a href=https://jugmac00.github.io/blog/ title=blog><span>blog</span></a></li><li><a href=https://jugmac00.github.io/til/ title=til><span>today-i-learned</span></a></li><li><a href=https://jugmac00.github.io/talks/ title=talks><span>talks</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>isort and pre-commit - a friendship with obstacles</h1><div class=post-meta><p></p>February 23, 2020</div></header><div class=post-content><h2 id=note>Note<a hidden class=anchor aria-hidden=true href=#note>#</a></h2><p>This post is not intended to be an exhaustive introduction to <code>pre-commit</code> and its hooks.
Please visit <a href=https://pre-commit.com/>pre-commit.com</a> for a complete documentation.</p><p>In a nutshell&mldr;</p><h2 id=pre-commit>pre-commit<a hidden class=anchor aria-hidden=true href=#pre-commit>#</a></h2><p>From its <a href=https://pre-commit.com/>website</a>:</p><blockquote><p>A framework for managing and maintaining multi-language pre-commit hooks.</p></blockquote><p>Very simplified this means, whenever you try to commit changes in your project (e.g. entering <code>git commit</code>),
<code>pre-commit</code> runs all configured tools (e.g. linter, formatter, &mldr;),
and only if they run successfully, your commit will be executed - otherwise your commit will fail.</p><p>This is really great, as you will never ever forget to run your linter or other tools.</p><h2 id=isort>isort<a hidden class=anchor aria-hidden=true href=#isort>#</a></h2><p>One of those tools, which pre-commit can execute for you, is <code>isort</code> - short for &ldquo;sort imports&rdquo;.</p><p>As the name suggests, this little helper sorts your import statements,
both alphabetical and also PEP 8 compliant,
means e.g. standard library imports are separated from the ones of third party tools.
And I like this a lot!</p><p>A sample configuration for <code>pre-commit</code> to use <code>isort</code> could look like this - by the way, this is YAML:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>-   <span style=color:#f92672>repo</span>: <span style=color:#ae81ff>https://github.com/timothycrosley/isort</span>
    <span style=color:#f92672>rev</span>: <span style=color:#ae81ff>4.3.21</span>
    <span style=color:#f92672>hooks</span>:
    -   <span style=color:#f92672>id</span>: <span style=color:#ae81ff>isort</span>
</code></pre></div><p>Also, you can customize <code>isort</code> to our liking, ie. put every import on one line.
This is just one of many configuration options.</p><p>And with the configuration options there comes the first problem.</p><h2 id=dont-touch-my-migrations>don&rsquo;t touch my migrations<a hidden class=anchor aria-hidden=true href=#dont-touch-my-migrations>#</a></h2><p>Whenever you run an application with a relational database,
you probably also need to keep track of <code>migrations</code>,
which usually consists of files with the diffs between two database schemes.</p><p>For my <code>Flask</code> app, those are stored in a subfolder called <code>migrations</code>.</p><p>No problem at all!
Let&rsquo;s use <code>isort's</code> <code>skip</code> / <code>skip-glob</code> option
(see <code>isort's</code> <a href=https://github.com/timothycrosley/isort/wiki/isort-Settings>wiki</a>).</p><p>Looks easy enough.</p><p>After some <a href=https://github.com/timothycrosley/isort/issues/282>googling</a>,
my first try would be something like this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=color:#66d9ef>[isort]</span>
<span style=color:#a6e22e>skip</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>migrations</span>
</code></pre></div><p>This does not work. Hm, maybe I need to use globbing (wildcards)?</p><h2 id=note-1>Note<a hidden class=anchor aria-hidden=true href=#note-1>#</a></h2><p>I put <code>isort</code>&rsquo;s configuration into my <code>tox.ini</code> file.
You can certainly also use a dedicated <code>.isort.cfg</code> file.
You&rsquo;d have to replace the section <code>isort</code> with <code>settings</code> then.</p><p>After some more googling I came up with this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=color:#66d9ef>[isort]</span>
<span style=color:#a6e22e>skip_glob</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>*/migrations/*.py</span>
</code></pre></div><p>Guess what? This also does not work. All my migration files still get sorted by <code>isort</code>.</p><p>After some more investigation,
I found <a href=https://github.com/timothycrosley/isort/issues/885>https://github.com/timothycrosley/isort/issues/885</a>
(as of 2021, this link no more works, as the repository was moved to another GitHub organization):</p><p>There is a new &ldquo;never skip when passed a filename&rdquo; behavior - which is&mldr; new.
So, even if you put a file or a pattern into a <code>skip</code> option,
it does not get skipped when passed to <code>isort</code> directly.
And this is what I assume <code>pre-commit</code> is doing.</p><p>Ok, in the same issue a workaround was mentioned:
Use <code>--filter-files</code> on the command line,
which by the way, I do not use, as I use <code>pre-commit</code>,
but fortunately you can add it to your <code>pre-commit</code> hook configuration:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>  - <span style=color:#f92672>repo</span>: <span style=color:#ae81ff>https://github.com/timothycrosley/isort</span>
    <span style=color:#f92672>rev</span>: <span style=color:#ae81ff>4.3.21</span>
    <span style=color:#f92672>hooks</span>:
    - <span style=color:#f92672>id</span>: <span style=color:#ae81ff>isort</span>
      <span style=color:#f92672>args</span>: [--<span style=color:#ae81ff>filter-files]</span>
</code></pre></div><p>It works!</p><h2 id=note-2>Note<a hidden class=anchor aria-hidden=true href=#note-2>#</a></h2><p>As an <a href=https://www.gitmemory.com/issue/pre-commit/mirrors-isort/9/511434587>alternative</a>,
you could also add an <code>exclude: migrations/</code> statement in your pre-commit-config.yaml.</p><p>Let me rather say&mldr; it worked, until I updated from <code>4.3.21</code> to <code>4.3.21-2</code> - there are no changelog entries available for this update,
but there were tons of changes,
including different behavior which files should be scanned.</p><p>With this update, all files gets processed by <code>isort</code>, including <code>.po</code>, <code>.rst</code>, <code>.json</code> and many more.</p><p>Ok, what can we do about it?</p><p>First, file an issue (<a href=https://github.com/timothycrosley/isort/issues/1154)>https://github.com/timothycrosley/isort/issues/1154)</a>.</p><p>Reading the excellent <code>pre-commit</code> documentation,
it seems there are several options,
but <a href=https://pre-commit.com/#creating-new-hooks><code>filter by files</code></a> looks very promising.</p><p>The <code>files</code> statement supports regular expressions, so the new hook looks like this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>  - <span style=color:#f92672>repo</span>: <span style=color:#ae81ff>https://github.com/timothycrosley/isort</span>
    <span style=color:#f92672>rev</span>: <span style=color:#ae81ff>4.3.21-2</span>
    <span style=color:#f92672>hooks</span>:
    - <span style=color:#f92672>id</span>: <span style=color:#ae81ff>isort</span>
      <span style=color:#f92672>args</span>: [--<span style=color:#ae81ff>filter-files]</span>
      <span style=color:#f92672>files</span>: <span style=color:#ae81ff>\.py$</span>
</code></pre></div><p>And here we go&mldr; it finally works as intended.</p><h2 id=update>Update<a hidden class=anchor aria-hidden=true href=#update>#</a></h2><p>I could track down the faulty behavior (<code>isort</code> also touches files which are not Python files) to a regression/packaging bug - <code>.pre-commit-hook.yaml</code> is broken for 4.3.21-2 - see the issue at <code>isort</code>&rsquo;s <a href=https://github.com/timothycrosley/isort/issues/1154#issuecomment-587517806>bug tracker</a>.</p><p>I removed the section about <code>seed-isort-config</code>,
using this package is no longer necessary with the latest <code>isort</code> versions.</p></div><footer class=post-footer></footer></article></main><footer class=footer><span>&copy; 2021 <a href=https://jugmac00.github.io>Jürgen Gmach</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script></body></html>