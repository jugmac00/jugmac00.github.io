<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>How to Create Hundreds of Pull Requests With a Single Command | Jürgen Gmach</title><meta name=keywords content><meta name=description content=".. or &ldquo;How to win #hacktoberfest&rdquo;?
Seriously&mldr;
 #hacktoberfest is no longer cool ( Hacktoberfest is Hurting Open Source ) you cannot win it anyway the mass pull requests I created (see below) went all to repositories, which do not take part at #hacktoberfest  note  If you are not interested in the story behind, I also created a concise &ldquo;today-I-learned&rdquo; post.
 prologue The company I work for has been using Zope, the grand-daddy of Python web application servers, for more than 15 years."><meta name=author content><link rel=canonical href=https://jugmac00.github.io/blog/how-to-create-hundreds-of-pull-requests-with-a-single-command/><link crossorigin=anonymous href=/assets/css/stylesheet.96771a12b249af1ff464eabdaa85d1a5268a4379a9f2da62cfd409656ff0233b.css integrity="sha256-lncaErJJrx/0ZOq9qoXRpSaKQ3mp8tpiz9QJZW/wIzs=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://jugmac00.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://jugmac00.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://jugmac00.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://jugmac00.github.io/apple-touch-icon.png><link rel=mask-icon href=https://jugmac00.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="How to Create Hundreds of Pull Requests With a Single Command"><meta property="og:description" content=".. or &ldquo;How to win #hacktoberfest&rdquo;?
Seriously&mldr;
 #hacktoberfest is no longer cool ( Hacktoberfest is Hurting Open Source ) you cannot win it anyway the mass pull requests I created (see below) went all to repositories, which do not take part at #hacktoberfest  note  If you are not interested in the story behind, I also created a concise &ldquo;today-I-learned&rdquo; post.
 prologue The company I work for has been using Zope, the grand-daddy of Python web application servers, for more than 15 years."><meta property="og:type" content="article"><meta property="og:url" content="https://jugmac00.github.io/blog/how-to-create-hundreds-of-pull-requests-with-a-single-command/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2020-10-28T15:02:44+02:00"><meta property="article:modified_time" content="2020-10-28T15:02:44+02:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="How to Create Hundreds of Pull Requests With a Single Command"><meta name=twitter:description content=".. or &ldquo;How to win #hacktoberfest&rdquo;?
Seriously&mldr;
 #hacktoberfest is no longer cool ( Hacktoberfest is Hurting Open Source ) you cannot win it anyway the mass pull requests I created (see below) went all to repositories, which do not take part at #hacktoberfest  note  If you are not interested in the story behind, I also created a concise &ldquo;today-I-learned&rdquo; post.
 prologue The company I work for has been using Zope, the grand-daddy of Python web application servers, for more than 15 years."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Blogs","item":"https://jugmac00.github.io/blog/"},{"@type":"ListItem","position":3,"name":"How to Create Hundreds of Pull Requests With a Single Command","item":"https://jugmac00.github.io/blog/how-to-create-hundreds-of-pull-requests-with-a-single-command/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"How to Create Hundreds of Pull Requests With a Single Command","name":"How to Create Hundreds of Pull Requests With a Single Command","description":".. or \u0026ldquo;How to win #hacktoberfest\u0026rdquo;?\nSeriously\u0026hellip;\n #hacktoberfest is no longer cool ( Hacktoberfest is Hurting Open Source ) you cannot win it anyway the mass pull requests I created (see below) went all to repositories, which do not take part at #hacktoberfest  note  If you are not interested in the story behind, I also created a concise \u0026ldquo;today-I-learned\u0026rdquo; post.\n prologue The company I work for has been using Zope, the grand-daddy of Python web application servers, for more than 15 years.","keywords":[],"articleBody":".. or “How to win #hacktoberfest”?\nSeriously…\n #hacktoberfest is no longer cool ( Hacktoberfest is Hurting Open Source ) you cannot win it anyway the mass pull requests I created (see below) went all to repositories, which do not take part at #hacktoberfest  note  If you are not interested in the story behind, I also created a concise “today-I-learned” post.\n prologue The company I work for has been using Zope, the grand-daddy of Python web application servers, for more than 15 years.\nWhat I love most about Zope, except for the stability and the low record of security issues, is the small but fine community.\nEspecially I love the fact, that almost all Zope plugins, which are sometimes called Products, are united in the zopefoundation GitHub organization, with a current count of 392, of which 330 are active.\nCombine the idea of a central repository with the ease of anybody to contribute, and you’ll see the obvious benefits immediately:\nDo you rely on one package, and there was a breaking change in a dependency?\nDo you need support for the newest Python version?\nNo problem, either ask somebody for help or fix it yourself. No single repository will be left behind.\nCompare this to other frameworks, where most of the plugins are maintained by single persons, which start extremely enthusiastic and at some point in time loose interest.\nHaving to maintain hundreds of repositories certainly comes with a cost.\nIt is especially tedious, when you have to do small changes to lots or even all repositories.\nthe initial situation We, the Zope maintainers/contributors, need to test our plugins against Python 3.9, but Travis, the CI system we use, only offered Python 3.9-dev, but no final version.\nSo we tested against 3.9-dev.\nthe “problem” Travis finally provides Python 3.9 final.\nBut how would we update all repositories which still use Python 3.9-dev?\nManually? No way!\nthe solution all-repos provides a set of CLI tools, which enables you to e.g. clone all repos of a GitHub organization, search in them, do mass updates to them, and even finally create pull requests.\nall-repos was created by one of the many Anthony Sottile clones out there, without them, the Python world would not be the same (Think of pre-commit, pyupgrade, tox, flake8, …).\nBefore you can start to work with all-repos, you need to\n install all-repos create a GitHub API token create a configuration file  I assume you are able to install a Python package, either via pipx, in a virtual environment, or …\nAlso, the token creation is straight forward. A token basically allows programs to interact with GitHub on your behalf.\nconfiguration The configuration is done with a JSON file, which is named all-repos.json by default.\nMine looks like so\n{ \"output_dir\": \"output\", \"source\": \"all_repos.source.github_org\", \"source_settings\": { \"api_key\": \"xxx\", \"org\": \"zopefoundation\" }, \"push\": \"all_repos.push.github_pull_request\", \"push_settings\": { \"api_key\": \"xxx\", \"username\": \"jugmac00\" } } where\n output_dir is the folder where the repositories are cloned into source is the way how to get hold of the repositories, in our case it is a GitHub organization api_key is needed in order to access / write to the repositories org is the corresponding GitHub organization push configures what should be done after changes had been applied, here it is “create a pull request on GitHub” username is the username which should be used for the pull request  Once this is done, we are ready to go.\ncloning all repositories The most basic task is to clone all repositories. Too easy? Think of Zope`s 300+ repositories.\n❯ all-repos-clone Initializing zopefoundation/zope.dottedname Initialized empty Git repository in /tmp/Zope/output/zopefoundation/zope.dottedname/.git/ Initializing zopefoundation/zc.relationship Initialized empty Git repository in /tmp/Zope/output/zopefoundation/zc.relationship/.git/ Initializing zopefoundation/zope.app.dependable ... grepping all repos Already one and a half year ago, I evaluated all-repos, but struggled a bit to wrap my head around advanced concepts like the so-called autofixers.\nOn the other hand, grepping was and is straight forward, e.g. the following command looks for 3.9-dev in all repositories' .travis.yml file.\n❯ all-repos-grep --repos-with-matches 3.9-dev -- '.travis.yml' output/zopefoundation/AccessControl output/zopefoundation/Acquisition output/zopefoundation/AuthEncoding output/zopefoundation/DocumentTemplate ... where\n all-repos-grep is the CLI tool we use = grep on all repositories --repos-with-matches = only show repositories with a match 3.9-dev = the string we are looking for .travis.yml = only look in files named .travis.yml  This is all fun, but how to get this party started?\nupdate all .travis.yml files  When you are on macOS, please have a look at the documentation as the following command uses GNU sed, which may not be present on macOS.\n While all-repos-grep and other CLI commands like all-repos-find-files are read-only, the real fun starts with so-called autofixers.\nBasically, an autofixer applies changes to all repositories which match a certain pattern.\nWhile there are pre-built autofixers like all-repos-sed, which we will use in a minute, you can also create autofixers yourself.\nOk, so we can bulk-modify repositories, but what then? How do I commit the changes? How do I create a branch? A pull request?\nOk, first things first, let’s try to update all repositories…\nall-repos-sed --commit-msg \"Use Python 3.9 final\" s/3.9-dev/3.9/g -- '.travis.yml'\nwhere\n all-repos-sed is the CLI command we use = use sed on all repositories --commit-msg \"Use Python 3.9 final\" = use a custom commit message s/3.9-dev/3.9/g = replace 3.9-dev with 3.9 .travis.yml = only look in .travis.yml files  Still, what about the branches, the commits and the pull request…? Never mind, let’s give it a go…\n/tmp/Zope ❯ all-repos-sed --commit-msg \"Use Python 3.9 final\" s/3.9-dev/3.9/g -- '.travis.yml' ***output/zopefoundation/Products.PythonScripts $ git clone --quiet output/zopefoundation/Products.PythonScripts /tmp/tmp_ve9eest $ git remote set-url origin git@github.com:zopefoundation/Products.PythonScripts $ git fetch --prune --quiet $ git checkout --quiet origin/HEAD -b all-repos_autofix_all-repos-sed $ sed -i s/3.9-dev/3.9/g .travis.yml $ git diff origin/HEAD --exit-code ***output/zopefoundation/ZODB $ git clone --quiet output/zopefoundation/ZODB /tmp/tmp56hy_wls $ git remote set-url origin git@github.com:zopefoundation/ZODB $ git fetch --prune --quiet $ git checkout --quiet origin/HEAD -b all-repos_autofix_all-repos-sed $ sed -i s/3.9-dev/3.9/g .travis.yml $ git diff origin/HEAD --exit-code ***output/zopefoundation/transaction $ git clone --quiet output/zopefoundation/transaction /tmp/tmpt5z_p_jc $ git remote set-url origin git@github.com:zopefoundation/transaction $ git fetch --prune --quiet $ git checkout --quiet origin/HEAD -b all-repos_autofix_all-repos-sed $ sed -i s/3.9-dev/3.9/g .travis.yml $ git diff origin/HEAD --exit-code ***output/zopefoundation/BTrees $ git clone --quiet output/zopefoundation/BTrees /tmp/tmpgw8mhej5 $ git remote set-url origin git@github.com:zopefoundation/BTrees $ git fetch --prune --quiet $ git checkout --quiet origin/HEAD -b all-repos_autofix_all-repos-sed $ sed -i s/3.9-dev/3.9/g .travis.yml $ git diff origin/HEAD --exit-code ***output/zopefoundation/persistent $ git clone --quiet output/zopefoundation/persistent /tmp/tmpk7vmtr0w $ git remote set-url origin git@github.com:zopefoundation/persistent $ git fetch --prune --quiet $ git checkout --quiet origin/HEAD -b all-repos_autofix_all-repos-sed $ sed -i s/3.9-dev/3.9/g .travis.yml $ git diff origin/HEAD --exit-code diff --git a/.travis.yml b/.travis.yml index dba5aa4..dda3ec5 100644 --- a/.travis.yml +++ b/.travis.yml @@ -17,7 +17,7 @@ python: - 3.6 - 3.7 - 3.8 - - 3.9-dev + - 3.9 jobs: include: $ git commit --quiet -a -m 'Use Python 3.9 final Committed via https://github.com/asottile/all-repos' $ git push origin HEAD:all-repos_autofix_all-repos-sed --quiet remote: remote: Create a pull request for 'all-repos_autofix_all-repos-sed' on GitHub by visiting: remote: https://github.com/zopefoundation/persistent/pull/new/all-repos_autofix_all-repos-sed remote: Pull request created at https://github.com/zopefoundation/persistent/pull/152 ... Holy moly! It’s a thing!\nOne after another, this awesome tool goes through all repositories, creates a branch, updates .travis.yml, commits the changes, and creates a pull request, all automagically!\nYeah, I know, that is what it is supposed to do, but holy sh… it’s real!\nmeanwhile on Travis meanwhile on GitHub Poor co-maintainers, who need to review all those pull requests!\nOne of them already asked, whether it is possible to directly push to master… yes, it is!\nafter one hour in my inbox conclusion This amazing tool works like a charm! For this task, it saved me at least a couple of hours.\nAnd there is much more it can do!\nthanks Thanks a lot, Anthony! all-repos certainly is another invaluable asset for working as a professional software developer, and it especially helps maintaining open source projects on a large scale.\nfurther information  concise version of this blog post all-repos on PyPI Anthony on Twitter  updates 2020-10-28\n add info on how to directly push to master  2020-03-11\n remove criticism of the documentation, constructive attempts to fix it is better, right? add default name of configuration file  ","wordCount":"1341","inLanguage":"en","datePublished":"2020-10-28T15:02:44+02:00","dateModified":"2020-10-28T15:02:44+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://jugmac00.github.io/blog/how-to-create-hundreds-of-pull-requests-with-a-single-command/"},"publisher":{"@type":"Organization","name":"Jürgen Gmach","logo":{"@type":"ImageObject","url":"https://jugmac00.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><header class=header><nav class=nav><div class=logo><a href=https://jugmac00.github.io accesskey=h title="Jürgen Gmach (Alt + H)">Jürgen Gmach</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://jugmac00.github.io/about/ title=about><span>about</span></a></li><li><a href=https://jugmac00.github.io/blog/ title=blog><span>blog</span></a></li><li><a href=https://jugmac00.github.io/til/ title=til><span>today-i-learned</span></a></li><li><a href=https://jugmac00.github.io/talks/ title=talks><span>talks</span></a></li><li><a href=https://jugmac00.github.io/hiring/ title=hiring><span>hiring</span></a></li><li><a href=https://jugmac00.github.io/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>How to Create Hundreds of Pull Requests With a Single Command</h1><div class=post-meta><span title="2020-10-28 15:02:44 +0200 +0200">October 28, 2020</span></div></header><div class=post-content><p>.. or &ldquo;How to win <strong>#hacktoberfest</strong>&rdquo;?</p><p>Seriously&mldr;</p><ul><li><strong>#hacktoberfest</strong> is no longer cool ( <a href=https://blog.domenic.me/hacktoberfest/>Hacktoberfest is Hurting Open Source</a> )</li><li>you cannot win it anyway</li><li>the mass pull requests I created (see below) went all to repositories, which do not take part at <strong>#hacktoberfest</strong></li></ul><h2 id=note>note<a hidden class=anchor aria-hidden=true href=#note>#</a></h2><blockquote><p>If you are not interested in the story behind,
I also created a <a href=https://jugmac00.github.io/til/how-to-update-all-zope-repositories-at-once/>concise &ldquo;today-I-learned&rdquo; post</a>.</p></blockquote><h2 id=prologue>prologue<a hidden class=anchor aria-hidden=true href=#prologue>#</a></h2><p>The company I work for has been using <a href=https://github.com/zopefoundation/Zope/>Zope</a>,
the grand-daddy of Python web application servers,
for more than 15 years.</p><p>What I love most about <strong>Zope</strong>,
except for the stability and the low record of <a href=https://www.cvedetails.com/vulnerability-list/vendor_id-370/Zope.html>security issues</a>,
is the small but fine community.</p><p>Especially I love the fact, that almost all <strong>Zope</strong> plugins,
which are sometimes called <strong>Products</strong>,
are united in the <a href=https://github.com/zopefoundation><code>zopefoundation</code></a> GitHub organization,
with a current count of 392, of which 330 are active.</p><p>Combine the idea of a central repository
with the ease of anybody to <a href=https://www.zope.org/developer/becoming-a-committer.html>contribute</a>,
and you&rsquo;ll see the obvious benefits immediately:</p><p>Do you rely on one package, and there was a breaking change in a dependency?</p><p>Do you need support for the newest Python version?</p><p>No problem, either ask somebody for help or fix it yourself.
No single repository will be left behind.</p><p>Compare this to other frameworks,
where most of the plugins are maintained by single persons,
which start extremely enthusiastic and at some point in time loose interest.</p><p>Having to <strong>maintain hundreds</strong> of repositories certainly comes with a cost.</p><p>It is especially tedious,
when you have to do small changes to lots or even all repositories.</p><h2 id=the-initial-situation>the initial situation<a hidden class=anchor aria-hidden=true href=#the-initial-situation>#</a></h2><p>We, the Zope maintainers/contributors,
need to test our plugins against Python <code>3.9</code>,
but <a href=https://travis-ci.com/>Travis</a>,
the CI system we use,
only offered Python <code>3.9-dev</code>, but no final version.</p><p>So we tested against <code>3.9-dev</code>.</p><h2 id=the-problem>the &ldquo;problem&rdquo;<a hidden class=anchor aria-hidden=true href=#the-problem>#</a></h2><p>Travis finally provides <a href=https://travis-ci.community/t/python-3-9-0-build/10091/13>Python 3.9 final</a>.</p><p>But how would we <a href=https://github.com/zopefoundation/meta/issues/37>update all repositories</a> which still use Python <code>3.9-dev</code>?</p><p><a href=https://github.com/zopefoundation/meta/issues/37#issuecomment-717751883>Manually?</a> No way!</p><h2 id=the-solution>the solution<a hidden class=anchor aria-hidden=true href=#the-solution>#</a></h2><p><a href=https://github.com/asottile/all-repos>all-repos</a> provides a set of CLI tools,
which enables you to e.g. clone all repos of a GitHub organization,
search in them,
do mass updates to them,
and even finally create pull requests.</p><p><code>all-repos</code> was created by one of the many Anthony Sottile clones out there,
without them, the Python world would not be the same
(Think of <code>pre-commit</code>, <code>pyupgrade</code>, <code>tox</code>, <code>flake8</code>, &mldr;).</p><p>Before you can start to work with <code>all-repos</code>,
you need to</p><ul><li>install <a href=https://pypi.org/project/all-repos/>all-repos</a></li><li><a href=https://github.com/settings/tokens/new>create a GitHub API token</a></li><li>create a configuration file</li></ul><p>I assume you are able to install a Python package, either via <code>pipx</code>, in a virtual environment, or &mldr;</p><p>Also, the token creation is straight forward.
A token basically allows programs to interact with GitHub on your behalf.</p><h3 id=configuration>configuration<a hidden class=anchor aria-hidden=true href=#configuration>#</a></h3><p>The configuration is done with a JSON file, which is named <code>all-repos.json</code> by default.</p><p>Mine looks like so</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
    <span style=color:#f92672>&#34;output_dir&#34;</span>: <span style=color:#e6db74>&#34;output&#34;</span>,
    <span style=color:#f92672>&#34;source&#34;</span>: <span style=color:#e6db74>&#34;all_repos.source.github_org&#34;</span>,
    <span style=color:#f92672>&#34;source_settings&#34;</span>:  {
        <span style=color:#f92672>&#34;api_key&#34;</span>: <span style=color:#e6db74>&#34;xxx&#34;</span>,
        <span style=color:#f92672>&#34;org&#34;</span>: <span style=color:#e6db74>&#34;zopefoundation&#34;</span>
    },
    <span style=color:#f92672>&#34;push&#34;</span>: <span style=color:#e6db74>&#34;all_repos.push.github_pull_request&#34;</span>,
    <span style=color:#f92672>&#34;push_settings&#34;</span>: {
        <span style=color:#f92672>&#34;api_key&#34;</span>: <span style=color:#e6db74>&#34;xxx&#34;</span>,
        <span style=color:#f92672>&#34;username&#34;</span>: <span style=color:#e6db74>&#34;jugmac00&#34;</span>
    }
}
</code></pre></div><p>where</p><ul><li><code>output_dir</code> is the folder where the repositories are cloned into</li><li><code>source</code> is the way how to get hold of the repositories, in our case it is a GitHub organization</li><li><code>api_key</code> is needed in order to access / write to the repositories</li><li><code>org</code> is the corresponding GitHub organization</li><li><code>push</code> configures what should be done after changes had been applied, here it is &ldquo;create a pull request on GitHub&rdquo;</li><li><code>username</code> is the username which should be used for the pull request</li></ul><p>Once this is done, we are ready to go.</p><h3 id=cloning-all-repositories>cloning all repositories<a hidden class=anchor aria-hidden=true href=#cloning-all-repositories>#</a></h3><p>The most basic task is to clone all repositories. Too easy? Think of Zope`s 300+ repositories.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>❯ all-repos-clone
Initializing zopefoundation/zope.dottedname
Initialized empty Git repository in /tmp/Zope/output/zopefoundation/zope.dottedname/.git/
Initializing zopefoundation/zc.relationship
Initialized empty Git repository in /tmp/Zope/output/zopefoundation/zc.relationship/.git/
Initializing zopefoundation/zope.app.dependable
...
</code></pre></div><h3 id=grepping-all-repos>grepping all repos<a hidden class=anchor aria-hidden=true href=#grepping-all-repos>#</a></h3><p>Already one and a half year ago, I evaluated <code>all-repos</code>,
but struggled a bit to wrap my head around advanced concepts like the so-called <code>autofixers</code>.</p><p>On the other hand, grepping was and is straight forward,
e.g. the following command looks for <code>3.9-dev</code> in all repositories' <code>.travis.yml</code> file.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>❯ all-repos-grep --repos-with-matches 3.9-dev -- <span style=color:#e6db74>&#39;.travis.yml&#39;</span>
output/zopefoundation/AccessControl
output/zopefoundation/Acquisition
output/zopefoundation/AuthEncoding
output/zopefoundation/DocumentTemplate
...
</code></pre></div><p>where</p><ul><li><code>all-repos-grep</code> is the CLI tool we use => grep on all repositories</li><li><code>--repos-with-matches</code> => only show repositories with a match</li><li><code>3.9-dev</code> => the string we are looking for</li><li><code>.travis.yml</code> => only look in files named <code>.travis.yml</code></li></ul><p>This is all fun, but how to get this party started?</p><h3 id=update-all-travisyml-files>update all <code>.travis.yml</code> files<a hidden class=anchor aria-hidden=true href=#update-all-travisyml-files>#</a></h3><blockquote><p>When you are on <strong>macOS</strong>, please have a look at the <a href=https://github.com/asottile/all-repos#all-repos-sed-options-expression-filenames>documentation</a> as the following command uses <strong>GNU sed</strong>,
which may not be present on macOS.</p></blockquote><p>While <code>all-repos-grep</code> and other CLI commands like <code>all-repos-find-files</code> are read-only,
the real fun starts with so-called <code>autofixers</code>.</p><p>Basically, an <code>autofixer</code> applies changes to all repositories which match a certain pattern.</p><p>While there are pre-built <code>autofixers</code> like <code>all-repos-sed</code>,
which we will use in a minute,
you can also <a href=https://github.com/asottile/all-repos#writing-an-autofixer>create autofixers yourself</a>.</p><p>Ok, so we can bulk-modify repositories, but what then?
How do I commit the changes?
How do I create a branch?
A pull request?</p><p>Ok, first things first, let&rsquo;s try to update all repositories&mldr;</p><p><code>all-repos-sed --commit-msg "Use Python 3.9 final" s/3.9-dev/3.9/g -- '.travis.yml'</code></p><p>where</p><ul><li><code>all-repos-sed</code> is the CLI command we use => use <a href=https://www.gnu.org/software/sed/manual/sed.html>sed</a> on all repositories</li><li><code>--commit-msg "Use Python 3.9 final"</code> => use a custom commit message</li><li><code>s/3.9-dev/3.9/g</code> => replace <code>3.9-dev</code> with <code>3.9</code></li><li><code>.travis.yml</code> => only look in <code>.travis.yml</code> files</li></ul><p>Still, what about the branches, the commits and the pull request&mldr;? Never mind, let&rsquo;s give it a go&mldr;</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>/tmp/Zope 
❯ all-repos-sed --commit-msg <span style=color:#e6db74>&#34;Use Python 3.9 final&#34;</span> s/3.9-dev/3.9/g -- <span style=color:#e6db74>&#39;.travis.yml&#39;</span>
***output/zopefoundation/Products.PythonScripts
$ git clone --quiet output/zopefoundation/Products.PythonScripts /tmp/tmp_ve9eest
$ git remote set-url origin git@github.com:zopefoundation/Products.PythonScripts
$ git fetch --prune --quiet
$ git checkout --quiet origin/HEAD -b all-repos_autofix_all-repos-sed
$ sed -i s/3.9-dev/3.9/g .travis.yml
$ git diff origin/HEAD --exit-code
***output/zopefoundation/ZODB
$ git clone --quiet output/zopefoundation/ZODB /tmp/tmp56hy_wls
$ git remote set-url origin git@github.com:zopefoundation/ZODB
$ git fetch --prune --quiet
$ git checkout --quiet origin/HEAD -b all-repos_autofix_all-repos-sed
$ sed -i s/3.9-dev/3.9/g .travis.yml
$ git diff origin/HEAD --exit-code
***output/zopefoundation/transaction
$ git clone --quiet output/zopefoundation/transaction /tmp/tmpt5z_p_jc
$ git remote set-url origin git@github.com:zopefoundation/transaction
$ git fetch --prune --quiet
$ git checkout --quiet origin/HEAD -b all-repos_autofix_all-repos-sed
$ sed -i s/3.9-dev/3.9/g .travis.yml
$ git diff origin/HEAD --exit-code
***output/zopefoundation/BTrees
$ git clone --quiet output/zopefoundation/BTrees /tmp/tmpgw8mhej5
$ git remote set-url origin git@github.com:zopefoundation/BTrees
$ git fetch --prune --quiet
$ git checkout --quiet origin/HEAD -b all-repos_autofix_all-repos-sed
$ sed -i s/3.9-dev/3.9/g .travis.yml
$ git diff origin/HEAD --exit-code
***output/zopefoundation/persistent
$ git clone --quiet output/zopefoundation/persistent /tmp/tmpk7vmtr0w
$ git remote set-url origin git@github.com:zopefoundation/persistent
$ git fetch --prune --quiet
$ git checkout --quiet origin/HEAD -b all-repos_autofix_all-repos-sed
$ sed -i s/3.9-dev/3.9/g .travis.yml
$ git diff origin/HEAD --exit-code
diff --git a/.travis.yml b/.travis.yml
index dba5aa4..dda3ec5 <span style=color:#ae81ff>100644</span>
--- a/.travis.yml
+++ b/.travis.yml
@@ -17,7 +17,7 @@ python:
   - 3.6
   - 3.7
   - 3.8
-  - 3.9-dev
+  - 3.9
 
 jobs:
   include:
$ git commit --quiet -a -m <span style=color:#e6db74>&#39;Use Python 3.9 final
</span><span style=color:#e6db74>
</span><span style=color:#e6db74>Committed via https://github.com/asottile/all-repos&#39;</span>
$ git push origin HEAD:all-repos_autofix_all-repos-sed --quiet
remote: 
remote: Create a pull request <span style=color:#66d9ef>for</span> <span style=color:#e6db74>&#39;all-repos_autofix_all-repos-sed&#39;</span> on GitHub by visiting:
remote:      https://github.com/zopefoundation/persistent/pull/new/all-repos_autofix_all-repos-sed
remote: 
Pull request created at https://github.com/zopefoundation/persistent/pull/152
...
</code></pre></div><p>Holy moly! It&rsquo;s a thing!</p><p>One after another,
this awesome tool goes through all repositories,
creates a branch,
updates <code>.travis.yml</code>,
commits the changes,
and creates a pull request,
all automagically!</p><p>Yeah, I know, that is what it is supposed to do, but holy sh&mldr; it&rsquo;s real!</p><h3 id=meanwhile-on-travis>meanwhile on Travis<a hidden class=anchor aria-hidden=true href=#meanwhile-on-travis>#</a></h3><p><img loading=lazy src=/images/hundred-prs-travis.png alt=Travis></p><h3 id=meanwhile-on-github>meanwhile on GitHub<a hidden class=anchor aria-hidden=true href=#meanwhile-on-github>#</a></h3><p><img loading=lazy src=/images/hundred-prs-github.png alt=Pull-Request-Mania-at-GitHub></p><p>Poor co-maintainers, who need to review all those pull requests!</p><p>One of them already asked,
whether it is possible to directly push to master&mldr;
<a href=https://github.com/asottile/all-repos#all_repospushmerge_to_master>yes, it is</a>!</p><h3 id=after-one-hour-in-my-inbox>after one hour in my inbox<a hidden class=anchor aria-hidden=true href=#after-one-hour-in-my-inbox>#</a></h3><p><img loading=lazy src=/images/hundred-prs-inbox.png alt=email-flood></p><h2 id=conclusion>conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2><p>This amazing tool works like a charm!
For this task, it saved me at least a couple of hours.</p><p>And there is much more it can do!</p><h2 id=thanks>thanks<a hidden class=anchor aria-hidden=true href=#thanks>#</a></h2><p>Thanks a lot, Anthony!
<code>all-repos</code> certainly is another invaluable asset for working as a professional software developer,
and it especially helps maintaining <strong>open source</strong> projects on a large scale.</p><h2 id=further-information>further information<a hidden class=anchor aria-hidden=true href=#further-information>#</a></h2><ul><li><a href=https://jugmac00.github.io/til/how-to-update-all-zope-repositories-at-once/>concise version of this blog post</a></li><li><a href=https://pypi.org/project/all-repos/>all-repos</a> on PyPI</li><li><a href=https://twitter.com/codewithanthony>Anthony on Twitter</a></li></ul><h2 id=updates>updates<a hidden class=anchor aria-hidden=true href=#updates>#</a></h2><p>2020-10-28</p><ul><li>add info on how to <a href=https://github.com/asottile/all-repos#all_repospushmerge_to_master>directly push to master</a></li></ul><p>2020-03-11</p><ul><li>remove criticism of the documentation, <a href=https://github.com/asottile/all-repos/issues/140>constructive attempts to fix it is better</a>, right?</li><li>add default name of configuration file</li></ul></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://jugmac00.github.io>Jürgen Gmach</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script></body></html>