<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>How to Delete Anonymous Docker Volumes on Tear Down | Jürgen Gmach</title><meta name=keywords content="docker,docker-compose"><meta name=description content="On one of our servers, there is a demo application installed for our customers.
The application, which consists of two docker images, is managed by a docker-compose.yml file.
As the customers are able to change the data, the containers and the attached volume are torn down every night, and then rebuilt.
Monitoring made me aware, that we are running low on disk space.
Turns out the volumes do not get deleted with the current cronjob:"><meta name=author content><link rel=canonical href=https://jugmac00.github.io/til/how-to-delete-anonymous-docker-volumes-on-tear-down/><link crossorigin=anonymous href=/assets/css/stylesheet.min.309a3942f890eb0930959205be1f692b2f0e85115a8b0190361a25a37e54fffa.css integrity="sha256-MJo5QviQ6wkwlZIFvh9pKy8OhRFaiwGQNholo35U//o=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://jugmac00.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://jugmac00.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://jugmac00.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://jugmac00.github.io/apple-touch-icon.png><link rel=mask-icon href=https://jugmac00.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.82.0"><meta property="og:title" content="How to Delete Anonymous Docker Volumes on Tear Down"><meta property="og:description" content="On one of our servers, there is a demo application installed for our customers.
The application, which consists of two docker images, is managed by a docker-compose.yml file.
As the customers are able to change the data, the containers and the attached volume are torn down every night, and then rebuilt.
Monitoring made me aware, that we are running low on disk space.
Turns out the volumes do not get deleted with the current cronjob:"><meta property="og:type" content="article"><meta property="og:url" content="https://jugmac00.github.io/til/how-to-delete-anonymous-docker-volumes-on-tear-down/"><meta property="article:section" content="til"><meta property="article:published_time" content="2021-05-28T13:10:08+02:00"><meta property="article:modified_time" content="2021-05-28T13:10:08+02:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="How to Delete Anonymous Docker Volumes on Tear Down"><meta name=twitter:description content="On one of our servers, there is a demo application installed for our customers.
The application, which consists of two docker images, is managed by a docker-compose.yml file.
As the customers are able to change the data, the containers and the attached volume are torn down every night, and then rebuilt.
Monitoring made me aware, that we are running low on disk space.
Turns out the volumes do not get deleted with the current cronjob:"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Today I Learned","item":"https://jugmac00.github.io/til/"},{"@type":"ListItem","position":3,"name":"How to Delete Anonymous Docker Volumes on Tear Down","item":"https://jugmac00.github.io/til/how-to-delete-anonymous-docker-volumes-on-tear-down/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"How to Delete Anonymous Docker Volumes on Tear Down","name":"How to Delete Anonymous Docker Volumes on Tear Down","description":"On one of our servers, there is a demo application installed for our customers.\nThe application, which consists of two docker images, is managed by a docker-compose.yml file.\nAs the customers are able to change the data, the containers and the attached volume are torn down every night, and then rebuilt.\nMonitoring made me aware, that we are running low on disk space.\nTurns out the volumes do not get deleted with the current cronjob:","keywords":["docker","docker-compose"],"articleBody":"On one of our servers, there is a demo application installed for our customers.\nThe application, which consists of two docker images, is managed by a docker-compose.yml file.\nAs the customers are able to change the data, the containers and the attached volume are torn down every night, and then rebuilt.\nMonitoring made me aware, that we are running low on disk space.\nTurns out the volumes do not get deleted with the current cronjob:\ndocker-compose down \u0026\u0026 docker-compose up -d As a quick fix, I ran a docker volumes ls, followed by a docker volume prune.\nThis deletes all unused local volumes.\nIn order to use this as an unattended command, you need to append the -f flag, otherwise you get prompted for confirmation.\nAs I am pretty new to Docker land, I looked around for other solutions.\nOne answer on StackOverflow suggests to use docker-compose -rm -fsv, where\n f stands for force, ie no confirmation necessary s stands for stop the containers, if necessary v removes anonymous volumes, attached to the containers  At the end, I settled for docker-compose down -v, where\n v removes both named, and anonymous volumes, attached to the container  So my new cronjob looks like\ndocker-compose down -v \u0026\u0026 docker-compose up -d I keep my fingers crossed - tomorrow I will now whether this worked out :-)\n","wordCount":"223","inLanguage":"en","datePublished":"2021-05-28T13:10:08+02:00","dateModified":"2021-05-28T13:10:08+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://jugmac00.github.io/til/how-to-delete-anonymous-docker-volumes-on-tear-down/"},"publisher":{"@type":"Organization","name":"Jürgen Gmach","logo":{"@type":"ImageObject","url":"https://jugmac00.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://jugmac00.github.io accesskey=h title="Jürgen Gmach (Alt + H)">Jürgen Gmach</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://jugmac00.github.io/about/ title=about><span>about</span></a></li><li><a href=https://jugmac00.github.io/blog/ title=blog><span>blog</span></a></li><li><a href=https://jugmac00.github.io/til/ title=til><span>today-i-learned</span></a></li><li><a href=https://jugmac00.github.io/talks/ title=talks><span>talks</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>How to Delete Anonymous Docker Volumes on Tear Down</h1><div class=post-meta>May 28, 2021</div></header><div class=post-content><p>On one of our servers, there is a demo application installed for our customers.</p><p>The application,
which consists of two docker images,
is managed by a <code>docker-compose.yml</code> file.</p><p>As the customers are able to change the data,
the containers and the attached volume are torn down every night,
and then rebuilt.</p><p>Monitoring made me aware,
that we are running low on disk space.</p><p>Turns out the volumes do not get deleted with the current cronjob:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>docker-compose down <span style=color:#f92672>&amp;&amp;</span> docker-compose up -d
</code></pre></div><p>As a quick fix, I ran a <code>docker volumes ls</code>, followed by a <code>docker volume prune</code>.</p><p>This deletes all unused local volumes.</p><p>In order to use this as an unattended command,
you need to append the <code>-f</code> flag,
otherwise you get prompted for confirmation.</p><p>As I am pretty new to Docker land,
I looked around for other solutions.</p><p>One <a href=https://stackoverflow.com/a/57726105/672833>answer on StackOverflow</a> suggests to use <code>docker-compose -rm -fsv</code>,
where</p><ul><li><code>f</code> stands for <code>force</code>, ie no confirmation necessary</li><li><code>s</code> stands for <code>stop</code> the containers, if necessary</li><li><code>v</code> removes anonymous volumes, attached to the containers</li></ul><p>At the end, I settled for <code>docker-compose down -v</code>,
where</p><ul><li><code>v</code> removes both named, and anonymous volumes, attached to the container</li></ul><p>So my new cronjob looks like</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>docker-compose down -v <span style=color:#f92672>&amp;&amp;</span> docker-compose up -d
</code></pre></div><p>I keep my fingers crossed - tomorrow I will now whether this worked out :-)</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://jugmac00.github.io/tags/docker/>docker</a></li><li><a href=https://jugmac00.github.io/tags/docker-compose/>docker-compose</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2021 <a href=https://jugmac00.github.io>Jürgen Gmach</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script></body></html>